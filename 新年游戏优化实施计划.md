# 新年游戏优化实施计划

## ✅ 已完成

### 1. 扩展题库 (完成)
- ✅ 从20道题扩展到100道题
- ✅ 创建 `quiz_data_extended.dart` 包含100道题
- ✅ 更新 `quiz_data.dart` 使用扩展题库
- ✅ 分类包括:美食习俗(20题)、年兽传说(15题)、生肖知识(20题)、传统习俗(25题)、节日知识(20题)

## 📋 待实施

### 2. 添加设置入口
**目标**: 在两个游戏中添加设置页面入口

#### 2.1 新年故事听听
- [ ] 在故事页面添加设置按钮
- [ ] 创建故事AI设置页面
- [ ] 添加导入知识库功能
- [ ] 添加格式说明提示

#### 2.2 新年知多少
- [ ] 在问答页面添加设置按钮  
- [ ] 链接到已有的 `QuizAISettingsPage`
- [ ] 在设置页面添加导入题库功能
- [ ] 添加JSON格式说明

### 3. 添加AI生图入口
**目标**: 在题库管理页面添加生成图片的入口

- [ ] 在问答页面添加"题库管理"按钮
- [ ] 题库管理页面已有批量生成功能
- [ ] 确保单个题目生成入口可见

### 4. 新年故事听听 - TTS优化
**目标**: 题目支持TTS播放和重播

#### 需要修改的文件
- `lib/pages/entertainment/story/story_page.dart`

#### 修改内容
- [ ] 题目出现时自动TTS播放
- [ ] 添加重播按钮
- [ ] 支持手动点击重播

### 5. 新年知多少 - TTS优化
**目标**: 完善TTS播放和重播功能

#### 需要修改的文件
- `lib/pages/entertainment/quiz/quiz_page.dart`

#### 5.1 选项TTS播放
- [ ] 题目显示时,TTS读出所有选项
- [ ] 添加重播按钮,可重新播放题目和选项

#### 5.2 答错后的停顿
- [ ] 在"没关系,再听听"和知识点播报之间添加1-2秒停顿
- [ ] 使用 `await Future.delayed(Duration(seconds: 1))`

#### 5.3 知识点重播
- [ ] 在知识点显示区域添加重播按钮
- [ ] 点击可重新播放知识点解释

## 🎯 实施优先级

### 高优先级 (立即实施)
1. ✅ 扩展题库到100题
2. 新年知多少 - TTS优化 (用户体验关键)
3. 添加设置入口 (功能可达性)

### 中优先级 (后续实施)
4. 新年故事听听 - TTS优化
5. 添加AI生图入口

## 📝 实施细节

### TTS播放逻辑

#### 题目播放
```dart
// 播放题目和选项
Future<void> _playQuestionAndOptions() async {
  // 播放题目
  await _tts.speak(_questions[_currentIndex]['question']);
  await Future.delayed(Duration(milliseconds: 500));
  
  // 播放选项
  final options = _questions[_currentIndex]['options'] as List;
  for (int i = 0; i < options.length; i++) {
    await _tts.speak('选项${i + 1}: ${options[i]}');
    await Future.delayed(Duration(milliseconds: 300));
  }
}
```

#### 知识点播放(带停顿)
```dart
// 答错后播放
Future<void> _playWrongAnswer() async {
  await _tts.speak('没关系,再听听');
  await Future.delayed(Duration(seconds: 1)); // 停顿1秒
  await _tts.speak(explanation);
}
```

### 重播按钮UI
```dart
IconButton(
  icon: Icon(Icons.replay, color: Colors.blue),
  onPressed: () => _replayContent(),
  tooltip: '重播',
)
```

### 导入知识库格式说明
```dart
Text(
  '支持的JSON格式:\n'
  '[\n'
  '  {\n'
  '    "question": "问题文本",\n'
  '    "emoji": "🧧",\n'
  '    "options": ["选项1", "选项2", "选项3", "选项4"],\n'
  '    "correctIndex": 0,\n'
  '    "explanation": "知识点解释",\n'
  '    "category": "分类"\n'
  '  }\n'
  ']',
  style: TextStyle(fontFamily: 'monospace'),
)
```

## 🔄 下一步行动

1. 先完成新年知多少的TTS优化(最影响用户体验)
2. 然后添加设置入口
3. 最后完成故事听听的TTS优化

---

**更新时间**: 2026-02-01 23:25
**当前状态**: 题库扩展完成,准备实施TTS优化
